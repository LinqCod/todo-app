# User API

Тестовое задание по написанию todo API

## Старт сервиса

1. Клонируем репозиторий проекта:
```
git clone https://github.com/LinqCod/todo-app.git
```
2. Далее необходимо сбилдить и запустить сервис. Сам сервис, как и бд (в данном случае postgres) работают в докер контейнерах, их конфигурация и связь прописаны в `docker-compose` файле. Также перед запуском следует установить пакет `golang-migrate`, если еще не был установлен.

### Команды

Для удобства все команды прописаны в `Makefile`

 - Для запуска сервиса достаточно использовать команду `make service-up`, которая сбилдит и запустит приложение, доступное на порту 8080:

```
make service-up
```

 - Для последующих запусков сервиса достаточно использовать команду `make service-run`, которая будет запускать уже существующий контейнер.

```
make service-run
```

 - Для завершения работы сервиса следует воспользоваться командой:

```
make service-down
```

 - Для создания файлов миграции таблицы задач необходимо выполнить следующую команду (для удобства файлы миграции, которые создают и дропают таблицу задач, уже присутствуют в проекте):

```
make migration-create-tasks
```

 - Чтобы накатить миграции достаточно выполнить команду:

```
make migration-up
``` 

 - Для роллбека миграций воспользуйтесь командой:

```
make migration-down
``` 

 - Для удобства добавлена команда для входа в postgres терминал созданной базы данных:

```
make shell-postgres
```
 
## О реализации

 - Сервис реализован, используя основные концепции `Clean Architecture` (разделение на слои handlers, repository и usecase, а также доменную область)
 - Для создания основного контейнера сервиса используется `multi-stage build` дабы уменьшить вес итогового контейнера и увеличить скорость его запуска
 - Конфигурация вынесена в `local.yaml` файл, для прописания переменных окружения - `.env` файл. Для инициализации и взаимодействия с конфигом используется пакет `cleanenv`, также реализовано чтение пути конфига как при помощи флагов, так и при помощи переменной окружения.
 - Для логирования используется библиотека `slog`
 - Настроена валидация полей при помощи пакета `validator`
 - Сгенерирована `swagger` документация, также обновить ее можно посредством команды `make swag-gen`
 - Реализован механизм `graceful shutdown` для грамотного завершения сервиса
 - К сожалению, этап с написанием тестовых кейсов не был завершен, по причине нехватки времени, однако, основа была заложена.

## Эндпоинты
 - SWAGGER - localhost:8080/api/v1/docs/index.html - страница документации апи

 - POST /api/v1/tasks - создание задачи. На вход принимает json-объект с обязательными полями title, description, assigned_date, is_completed.
 - DELETE /api/v1/tasks/:id - удаление задачи по айди. На вход принимает айди задачи в качестве path параметра.
 - PATCH /api/v1/tasks/:id - изменение задачи по айди. На вход принимает айди задачи в качестве path параметра, а также json-объект с новыми значениями полей. Если какие то поля не будут указаны в request body, в базе они останутся прежними.
 - GET /api/v1/tasks/:id - получение задачи по айди. На вход принимает айди задачи в качестве path параметра.
 - GET /api/v1/users - получение отфильтрованного списка задач с добавленной пагинацией. Фильтрация происходит путем указания следующих необязательных query параметров: date, isCompleted; для пагинации используется метод offset/limit, соответственно, именно данные поля необходимо указывать в качестве query параметров. Параметры можно указать как все, так и часть, или вообще не указывать. В случае, если какие то параметры не указаны, они не будут учитываться при фильтрации. 


